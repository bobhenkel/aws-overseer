---
- name: Stop hosts managed by this overseer.
  hosts: localhost
  connection: local
  gather_facts: no
  sudo: no

  tasks:
    - name: Ensure that instances with the specified StartStopSchedule are stopped.
      ec2:
        region: "{{ overseer_aws_region }}"
        aws_access_key: "{{ overseer_aws_access_key }}"
        aws_secret_key: "{{ overseer_aws_secret_key }}"
        instance_tags:
          Overseer: "{{ overseer_name }}"
          StartStopSchedule: "{{ '{{ schedule_name }}' }}"
        state: stopped
